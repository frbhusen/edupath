{% extends 'base.html' %}
{% block content %}
<div class="card shadow-sm mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <div class="text-muted small">الدرس</div>
      <h2 class="h5 mb-0">{{ lesson.title }}</h2>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-primary btn-sm" href="{{ url_for('teacher.edit_lesson', lesson_id=lesson.id) }}">تعديل</a>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('teacher.manage_lesson_access', lesson_id=lesson.id) }}">إدارة الوصول</a>
      <form method="post" action="{{ url_for('teacher.delete_lesson', lesson_id=lesson.id) }}" onsubmit="return confirm('حذف الدرس؟');">
        <button class="btn btn-outline-danger btn-sm" type="submit">حذف</button>
      </form>
    </div>
  </div>
  <div class="card-body">
    <div class="text-muted small mb-2">يتطلب كود: {{ 'نعم' if lesson.requires_code else 'لا' }}</div>
    <div class="border rounded p-3 bg-light">{{ lesson.content | safe }}</div>

    {% if lesson.link_label and lesson.link_url %}
      <div class="mt-3">
        <a href="{{ lesson.link_url }}" target="_blank" class="btn btn-outline-primary btn-sm">{{ lesson.link_label }}</a>
      </div>
    {% endif %}
    {% if lesson.link_label_2 and lesson.link_url_2 %}
      <div class="mt-2">
        <a href="{{ lesson.link_url_2 }}" target="_blank" class="btn btn-outline-primary btn-sm">{{ lesson.link_label_2 }}</a>
      </div>
    {% endif %}
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="h6 mb-0">الموارد</h3>
  <a class="btn btn-cta btn-sm" href="{{ url_for('teacher.new_lesson_resource', lesson_id=lesson.id) }}">إضافة مورد</a>
</div>

{% if resources %}
  <div class="list-group mb-4">
    {% for res in resources %}
      <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
          <div class="fw-semibold">{{ res.label }}</div>
          <div class="text-muted small">{{ res.resource_type or 'رابط' }}</div>
          <a href="{{ res.url }}" target="_blank">{{ res.url }}</a>
        </div>
        <form method="post" action="{{ url_for('teacher.delete_lesson_resource', resource_id=res.id) }}" onsubmit="return confirm('حذف المورد؟');">
          <button class="btn btn-outline-danger btn-sm" type="submit">حذف</button>
        </form>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-light">لا توجد موارد بعد.</div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="h6 mb-0">اختبارات الدرس</h3>
  <a class="btn btn-cta btn-sm" href="{{ url_for('teacher.new_test', section_id=lesson.section.id) }}">إضافة اختبار</a>
</div>

{% if tests %}
  <div class="list-group">
    {% for test in tests %}
      <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div class="fw-semibold">{{ test.title }}</div>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-primary btn-sm" href="{{ url_for('teacher.test_detail', test_id=test.id) }}">عرض</a>
          <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('teacher.edit_test', test_id=test.id) }}">تعديل</a>
          <form method="post" action="{{ url_for('teacher.delete_test', test_id=test.id) }}" onsubmit="return confirm('حذف الاختبار؟');">
            <button class="btn btn-outline-danger btn-sm" type="submit">حذف</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-light">لا توجد اختبارات للدرس بعد.</div>
{% endif %}
{% endblock %}
