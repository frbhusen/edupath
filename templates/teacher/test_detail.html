{% extends 'base.html' %}
{% block content %}
<div class="card shadow-sm mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <div class="text-muted small">الاختبار</div>
      <h2 class="h5 mb-0">{{ test.title }}</h2>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-primary btn-sm" href="{{ url_for('teacher.edit_test', test_id=test.id) }}">تعديل</a>
      <form method="post" action="{{ url_for('teacher.delete_test', test_id=test.id) }}" onsubmit="return confirm('حذف الاختبار؟');">
        <button class="btn btn-outline-danger btn-sm" type="submit">حذف</button>
      </form>
    </div>
  </div>
  <div class="card-body">
    {% if test.description %}
      <p>{{ test.description }}</p>
    {% endif %}
    <div class="text-muted small">يتطلب كود: {{ 'نعم' if test.requires_code else 'لا' }}</div>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="h6 mb-0">الأسئلة</h3>
  <a class="btn btn-cta btn-sm" href="{{ url_for('teacher.new_question', test_id=test.id) }}">إضافة سؤال</a>
</div>

{% if questions %}
  <div class="list-group">
    {% for question in questions %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div>
            <div class="fw-semibold">{{ question.text }}</div>
            {% if question.hint %}
              <div class="text-muted small">{{ question.hint }}</div>
            {% endif %}
          </div>
          <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('teacher.edit_question', question_id=question.id) }}">تعديل</a>
            <form method="post" action="{{ url_for('teacher.delete_question', question_id=question.id) }}" onsubmit="return confirm('حذف السؤال؟');">
              <button class="btn btn-outline-danger btn-sm" type="submit">حذف</button>
            </form>
          </div>
        </div>
        {% if question.choices %}
          <ul class="mt-2">
            {% for choice in question.choices %}
              <li class="{{ 'text-success fw-semibold' if choice.is_correct else '' }}">
                {{ choice.text }}
                {% if choice.is_correct %}<span class="badge bg-success">صحيح</span>{% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-light">لا توجد أسئلة بعد.</div>
{% endif %}
{% endblock %}
